## 第一章：概述
### 计算机⽹络基本概念 	了解
计算机网络是由不同通信媒体和中继设备连接的、物理上独立的多台计算机组成的、将需传输的数据分成不同长度的分组进行传输和处理的系统

- 多台自主计算机的互联系统 
- 必须指定网络中哪一台计算机来完成什么样的操作，即客户/服务器的工作方式
### 硬件包括，软件包括
硬件：

- 计算机
- 通信媒体：传输信息的通道，如双绞线、光纤
- 中继设备

软件：网络协议
### 术语

- 信道：信息的通道。通常一条物理媒体上可以有多个信道
- 数据：所要传输的信息，有数字数据和模拟数据
- 信号：数据的载体，通常用数字信号或模拟信号
- 数字传输和模拟传输
- 带宽：有效的频率范围，即构成信号的最高频和最低频之差
- 数据传输率：每秒能传输多少bit
- 单工、半双工和全双工传输
### 交换⽅式	重点
#### 电路交换

- 在数据传输前，**必须建立一条端到端的通路**，称为**连接**，该连接可能穿越多个交换局，而每个交换局都必须为之提供连接
- 一旦建立连接，整个通路将被独占，除信号传播的延时之外，数据传输**无额外延时**，数据中**毋需包含目的地址**
- **线路的利用率较低**
- 建立连接时间长，连接建立时冲突概率高 
#### 存储转发

- 数据的传输**毋需建立连接**，数据的传输是一站一站往下送，无论数据传输过程要跨越多少个交换局（通常是路由器），只要下一站不忙，该数据即送至下一站
- 数据中**必须包含目的地址**，并**采用存储-转发机制**
- **线路的利用率较高**
- 由于采用store-forward机制，所以在数据传输过程中，除了信号传播的延时之外，还有存储和转发的延时，而且**可能延时较大**，且不可估计
##### 报文交换

- 将要发送的数据**打成一个包**，按**存储转发**的模式发送
- 缺点：包的长度变化很大，无法在内存预留空间，通常**存储在外存储器**上，影响了访问的速度
##### 分组交换

- 报文长度有个上限，每个报文称为一个**分组**
- 当发送的信息很长时，将被**分为若干个定长的分组**
- 每个分组中**必须包含目的地址**，并采用**存储-转发**机制
- 每个中间站点必须有缓存，但由于报文大小固定，所以缓存通常**在内存**中设置
- **接收分组和发送分组的顺序可能不一致** ，在目的站点需要将某一消息对应的所有分组重组起来恢复成发送的消息
#### 虚电路交换

- 将**电路交换和分组交换结合**起来
- 传输前**先建立连接**，即找好通路。信息还是以**分组的形式传输**。
- 优点
   - 在分组传输时不需要找路径，**提高传输速率**
   - 分组传输时，占用线路。传输结束后可以供其它连接传输分组。**线路利用率高**
### 报⽂交换、分组交换的特点好处

- 报文交换中，报文存放在**外存**。分组交换中，分组存放在**内存**。所以**分组转发的速度比报文转发要快**。
- 分组交换**有重组的问题**，报文交换无需考虑
### 交换技术图示	重点	图⽂结合
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391431118-49864ffa-97e9-40f1-9ac1-84397c368564.png#averageHue=%23b6e0eb&clientId=ued772dcd-aa97-4&from=paste&id=udb636f88&originHeight=515&originWidth=852&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u0dbee8f7-a2e4-4381-9791-cb825d17497&title=)
### ⽹络分类	了解
#### 按拓扑结构分

- 总线:以太网 所需的布线比星型少，总线断了网络就要失效。 
- 环形:IBM令牌环、FDDI 计算机容易协调；容易检测网络运行状况；一根电缆断了，整个环状网络都失效。
- 网状
- 星形:ATM 一根电缆断了不会影响整个网络。
#### 按技术分

- 广播式网络
- 点到点网络
#### 按规模分

- 个域网PAN：提供短距离的的通信，包括蓝牙、红外、ISM无线
- 局域网LAN：
   - 地域：覆盖范围较小 
   - 传输技术： 
      - 总线型 IEEE 802.3（以太网）CSMA/CD 10M
      - 总线型 IEEE 802.4（令牌总线）10M
      - 环 型 IEEE 802.5（IBM令牌环）4M 16M
- 城域网MAN：大型的LAN
- 广域网WAN：跨越地域较大的网络
   - 主机（host） 端点系统（end system）
   - 通信子网（communication subnet） 简称子网
      - 通信子网负责计算机之间的数据通信，由传输线和交换单元组成
         - 传输线
         - 交换单元		
         - 通常分组交换节点为路由器（router）
   - 资源子网（ resource subnet）
      - 由通信子网互连在一起的计算机构成
      - 资源子网中的计算机负责运行对信息进行处理的应用程序，他们是网络中信息流动的源与宿，向用户提供可供共享的硬件、软件和信息资源
- 互联网Internet
   - 通常由路由器联接的LAN或WAN组成
   - 通信子网通常由路由器组成
   - 路由器之间用点到点方式连接
   - 路由器的传输机理为分组交换 
#### 按传输介质分

- 有线网
- 无线网
#### 按使用范围分

- 专用网
- 公用网
### ISO/OSI 七层模型	必考
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391431178-e90ea87b-c81d-4141-af09-beb57a177b8c.png#averageHue=%23afdae5&clientId=ued772dcd-aa97-4&from=paste&id=uabb7869e&originHeight=704&originWidth=959&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=uff66aa3f-de49-43c3-8aae-e25bb8bc6eb&title=)
#### 分层的好处

- 通过每一层实现一种相对独立的功能来简化问题
- 每一层的设计都是独立的，它不必关心下一层是如何实现的，只需知道下一层为我提供的服务，和我必须为上一层提供哪些服务
- 当由于技术的变化使某层的实现需要变化时，不影响其他的层次
#### 物理层（physical layer）

- 与传输媒体的接口，完成**传输媒体上的信号与二进制数据间的转换**
- 物理接口上发送或接收的是一串以某种规则表示的二进制的数据
- 物理层定义的是接口的机械特性、电气特性、功能和过程特性等
#### 数据链路层（data link layer）

- 提供**点到点的可靠传输**，通常需把数据分成**帧**，并且保证帧的正确发送和接收
   - 识别帧的标志 
   - 帧的发送和接收，需校验、确认
   - 发送方在超时或收到否定性确认后，要重发
   - 重复帧要丢弃 
#### 网络层（network layer） 

- 提供**点到点**的通路，其间可能存在多条通路，网络层将实现的功能包括：
   - 选择路由 
   - 拥塞控制 
   - 协议的转换 
   - 分段和重组 
   - 对用户的分组、字符等计数 等等
#### 传输层（transport layer)

- 提供**端到端**的通路，应用到应用的通路
   - 传输层将把高层要求传输的数据分成若干个报文
   - **报文与帧不一样**，帧只有帧标志（起始标志、结束标志），而报文有信源和信宿的地址及端口、报文的顺序号、确认号等等 
   - 低三层的通信对象通常是路由器，传输层是端到端的，必须考虑该报文怎样才能从源端正确地传输到目的端，而源端和目的端通常是主机
#### 会话层（session layer） 

- 建立有关会话的机制，或双向对话，或双向对话时要有切换等
#### 表示层（presentation layer） 

- 表示层关心的是**语法和语义**
- 对相关的数据的描述采用抽象的定义，如浮点数都用科学表示法
   - 相关数据的表示法转换 
   - 抽象数据结构的转换
#### 应用层（application layer） 

- 包括**所有应用方面的协议**
   - 如：全屏幕功能，不同的终端其控制字符不尽相同，应作相应的转换，通常定义一个网络虚拟终端 
- 不同系统之间的文件传输的方式不同，但表示的形式必须一致 

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391431175-778631e2-b768-4611-85cd-4ce20564d4d9.png#averageHue=%23aed7e1&clientId=ued772dcd-aa97-4&from=paste&id=u73874011&originHeight=656&originWidth=908&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=ucf3c0783-2e85-4a97-baec-c3074066fcc&title=)
### TCP/IP 模型	必考
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391431226-97cf9546-4de2-4e47-968d-87494d7b16ba.png#averageHue=%23b2dce7&clientId=ued772dcd-aa97-4&from=paste&id=u65939dec&originHeight=658&originWidth=675&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=uc575afbc-0fb6-4020-a21b-1b73ace2369&title=)
#### 互联网层（internet layer） 

- 这里的互联网是**基于无连接的分组交换网络**
- 互联网层定义了正式的分组格式和协议，即**IP协议**（internet protocol），每个IP包的路由问题是互联网层要解决的问题
- 互联网层与OSI中的网络层相对应
- 一个报文的各个不同的分组（称为IP包），可以通过不同的路径到达目的地，其到达顺序与发送顺序可能不一致
#### 传输层（transport layer） 

- 位于互联网层的上层，与OSI中的传输层相对应 
- 其功能是使源端和目的端主机的对等实体进行对话
- 定义了两个端到端的协议：
   - 传输控制协议TCP（transmission control protocol）
   - 用户数据报协议UDP（user datagram protocol） 
#### 应用层（application layer） 

- TCP/IP模型的应用层包括所有的高层协议 （实际上，OSI模型中的会话层和表示层在很多应用中是没用的） 
- 应用层常用协议：
   - TELNET：标准终端仿真协议 
   - FTP（File Transfer Protocol）：文件传输协议 
   - SMTP（Simple Mail Transfer Protocol）： 电子邮件协议 
   - DNS（Domain Name Service）：域名系统服务
#### 主机至网络层 

- 在互联网层以下，TCP/IP参考模型没有定义，认为互联网是网络的互联，至于主机如何接入网络不是TCP/IP模型所需要考虑的问题
- TCP/IP模型面向的是网络，而不是主机
#### TCP/IP协议簇

- TCP/IP协议是一组协议的总称，包括：
   - IP层（即互联网层）：
      - IP、ICMP、ARP、RARP、OSPF… … 
   - TCP层（即传输层）：
      - TCP、UDP
   - 应用层：
      - FTP、SMTP、SNMP、TELNET、HTTP、DNS… … 
## 第二章：物理层
### 传输介质特性、速率快慢
#### 双绞线 （twisted pair）

- 由两根彼此绝缘的铜线按螺旋状绞合在一起。这一对线作为一条通信链路
- **线间干扰较小、价格便宜、易于安装**
- **可传输模拟信号，也可传输数字信号**
- 无屏蔽和屏蔽双绞线：屏蔽双绞线就是在双绞线外加一层金属网罩或护皮，使之能抵抗环境的干扰
- 3类双绞线通常用于话音级电缆。如果传输距离不远，**3类双绞线的数据传输率可达16Mbps**
- **5类**双绞线是数据级电缆，**传输速率可达100Mbps**
#### 同轴电缆

- 由一根空心的圆柱体的外导线和柱体内部的一根内导线组成
- 比双绞线**传输的距离长，传输率也更高**
- 用途：
   - 电视节目的传输
   - 长途电话的传输
   - 局域网
#### 光缆 

- 由玻璃或塑料组成
- 多模光缆：信号通过光的折射在光纤中传输，距离2 km
- 单模光缆：直线传输，距离10 km
- 特点
   - **传输速率更高**
   - **体积更小、重量更轻**
   - 衰减更小**不受外部电磁场的干扰**
- 应用
   - 长途干线
   - 市区的干线
   - 局域网
#### 无线传输 
根据波长分成不同的波段，依次为无线电、微波、红外、可见光、紫外等 

- 无线电传输 
- 微波传输 
- 红外线
- 光波传输 

无线通信频段：**通常用微波或红外线**
地面微波模型：

- 传输距离：天线的高度、类型和信号强度
- 传输可靠性：障碍物
- 传输正确性：气象条件
- 用途：用于代替同轴电缆或光缆
#### 卫星通信

- 将通信卫星作为一个**微波**中继站
- 用途
   - 电视节目
   - 长途电话
   - 商业网络
### 数字数据的模拟信号传输	简答题
将数字数据调制成模拟信号进行传输，通常有三种基本的调制方式：

1. 调幅ASK(Amplitude Shift Keying)
2. 调频FSK(Frequency Shift Keying)
3. 调相PSK(Phase Shift Keying) 
4. 目前广泛应用的调制技术是正交调相：QPSK(Quadrature Phase Shift Keying)
#### 调幅ASK

- 用载波的两个不同的振幅来表示两个二进制值 
- 如用无信号表示0	有信号表示1 
#### 调频FSK

- 用载波附近的两个不同的频率来表示两个二进制值 
- 如用信号频率为f表示0	信号频率为2f表示1 
#### 调相PSK

- 用载波的相位移动来表示两个二进制值
- 如用信号相位角为0表示0	相位角为表示1 

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391431180-9f3f3e59-6677-4563-9c5a-73161e72f8d8.png#averageHue=%23b2dbe6&clientId=ued772dcd-aa97-4&from=paste&id=u5c6868b0&originHeight=580&originWidth=838&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=ud0bf54c5-d547-49c4-b852-0ae633e7634&title=)
### 数字数据的数字信号传输	曼切斯特和差分曼切斯特编码	简答
#### 曼切斯特编码

- **bit中间有信号低-高跳变为0**
- **bit中间有信号高-低跳变为1**
- 采用曼切斯特编码，**一个时钟周期只可表示一个bit**，并且必须通过**两次采样才能得到一个bit**
- 但它**能携带时钟信号**，且可表示没有数据传输
#### 差分曼彻斯特编码

- bit中间有信号跳变，**bit与bit之间也有信号跳变，表示下一个bit为0**
- bit中间有信号跳变， **bit与bit之间无信号跳变，表示下一个bit为1**

特性**与曼切斯特编码相同**，但**抗干扰性能强于曼切斯特编码**
#### 编码方式的比较

- 曼切斯特编码的**编码密度最低**，接收端二次采样才可得到一个bit ，即波特率是比特率的两倍，但每个bit中都有信号跳变，即携带了时钟
- 差方曼切斯特编码与曼切斯特编码基本相同

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391431843-95a00e08-c6e8-4141-b5cc-3da399880e27.png#averageHue=%23b5dfe9&clientId=ued772dcd-aa97-4&from=paste&id=u578f11e9&originHeight=584&originWidth=864&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u64406a8e-e5df-449e-894b-65a841b600d&title=)
### 采样定理	采样量化编码
采样定理：如果在**规定的时间间隔**内，以有效信号f(t**)最高频率的二倍或二倍以上的速率**对该信号进行采样，则这些采样值中**包含了全部原始信号信息**
### 波特率和⽐特率	了解
#### 波特率

- 波特率：**每秒内信号能改变的速率**。显然，波特率越高，传输速率也越高
- 波特率**不能无限提高**，它**受限于信号频率**
- Nyquist采样定理：**最大的信号频率为H，则波特率为2H**
#### 比特率

- 比特率：**数据传输速率** bps
- 波特率与比特率
   - 如果传输的信号是二值的，每次**采样可以得到一个比特**，那么波特率等与比特率
   - 如果能将信号分成更多的等级，如4级，那么每个信号可以携带2个比特，每次**采样就能得到2个比特**，则比特率等于2倍的波特率
### 奈式定理，⾹农定理	计算题
#### Nyquist定理

- 在无噪声信道中，当带宽为H Hz，信号电平为V级，则：
   - 数据传输速率 = 2Hlog2V b/s（V：信号电平的级数，在二进制中，仅为0、1两级） 
#### 噪声对传输的影响

- 按照Nyquist定理，在硬件环境给定后，我们可以通过增加信号的等级来无限制地提高传输速率
- 线路是有噪声的，**噪声会干扰信号**。
#### Shannon定理 

- 在**噪声信道**中，当带宽为H Hz，信噪比为S/N，则：	最大数据传输速率(b/s) = Hlog2(1+S/N) 
- 很多情况下信噪比用分贝（dB） 表示	信噪比（dB）= 10log10S/N 
   - 如： 信噪比为30dB，则S/N=1000
#### 举例：噪声信道中的传输速率

- 在噪声信道（话音信道）中，当带宽为3500Hz，信噪比为30dB（较为典型的电话信道），则：	最大数据传输速率(b/s) = Hlog2(1+S/N)		= 3500log2(1+1000)		= 35000 (b/s)
- 最大数据传输速率为35k bps，这是在噪声信道中的传输速率极限，实际上是不可能达到的
### 频分多路时分多路	了解
#### 频分多路复用

- 将每路信号调制到不同的载波频率上，保证这些载波频率的间距足够大，使各路信号不会重丢
- 媒体上传输的混合信号是模拟信号
- 通常信道之间有隔离频带
- FDM的常用实例是广播和有线电视
#### 时分多路复用TDM
每个信号按时间先后轮流交替地使用单一信道，那么，多个数字信号在宏观上可认为是同时进行传输，对单一信道的交替使用可以按位、字节或块等为单位来进行 
##### 同步TDM

- 时间片与输入装置**一一对应**，即同步
- 如某个时间片对应的输入装置无数据发送，则该**时间片空闲（浪费）**
- 传输介质的传输速率**不能低于各个输入信号的数据速率之和**
##### 异步（统计）TDM

- **时间片是按需动态分配的**
- 时间片与输入装置之间**没有对应关系**，任何一个时间片都可以被用于传输任何一路输入信号
- 在传输的数据单元中**必须包含地址信息**，以便寻址目的节点
- 传输介质的传输速率只要**不低于各个输入信号的平均数据速率**即可
- 异步TDM又称为统计TDM（STDM） 
### ⾯向⽐特透明传输
在面向bit流的同步通信中，为了避免在数据块的数据中出现标记数据块开始和结束的特殊位模式(如01111110) ，通常采用位插入法，即发送端总是检测所发送的数据流，**每当出现连续的五个1后便自动插入一个0**，接收端在接收数据流时，如果检测到连续五个1的序列，就检查其后的一个bit，若该bit是0，则删除，若该bit为1，则表示数据块的结束，转入结束处理
### 物理层接⼝选择填空
#### 异步串行口RS-232

- RS-232-C是用于计算机或终端与Modem间的物理层协议，所谓物理层协议是定义接口的机械、电气、功能和过程特性 
- 计算机或终端设备： DTE（data terminal equipment）
- 调制解调器： DCE（data circuit-terminating equipment） 
- 常用的串行接口有25pin和9pin两种
#### 并行接口
打印机是常用的并行接口
#### RJ45
##### RJ-45接口接线标准T-568B

- RJ-45是最常用的网络接口
- RJ-45的电缆采用8芯5类线缆
##### 10Base-T 直通线缆 

- 用于连接交换机（或HUB）的RJ-45端口与主机网卡的RJ-45端口的连接电缆
##### 10Base-TX交叉线缆 

- 交换机（或HUB）的RJ-45端口连交换机（或HUB）的RJ-45端口
- 主机的RJ-45端口连主机的RJ-45端口
## 第三章：数据链路层
### 基本概念
数据链路层的上层是网络层，数据链路层将**借助于物理层为网络层提供服务**

- 为网络层提供一个较好的服务接口
- 为网络层提供可靠的传输服务

数据链路层的**协议数据单元（PDU）是帧**
数据链路：包括一条物理连接和为实现数据传输而在两端配置的硬件及其相关的通信协议
#### 功能

- 数据链路层的任务是把网络层的数字数据组合成帧，并加上一定的校验码后交物理层
- 物理层用不同的信号表示二进制数据位，从而把帧用一段连续的信号串表示并传送到目的主机
- 目的主机的物理层将信号还原成比特串交数据链路层，数据链路层确认正确后送到网络层
- 数据链路层为源和目的主机的网络层之间提供一条可靠的数据链路
### 数据链路层提供的服务	选择填空

- **确认**：接收方在收到数据帧后，必须给发送方发回一个确认
- **面向连接**：发送方和接收方在传输数据之前必须建立一条数据链路，传输结束后必须释放该链路 

数据链路层的服务是通过有无连接、有无确认来区分的
#### 无确认无连接的服务

- 无确认是指接收方在收到数据帧后，**毋需发回一个确认**
- 无连接的服务是指在**数据传输前毋需建立数据链路**
- 物理线路的连接并非意味着提供了有连接的服务
- 无确认并非不可靠，其**可靠性可由上层负责**
- **例如：局域网**
   - 共享信道不需要、也不允许建立连接
   - 信道较为理想，数据传输的误码率很低
   - 即使出错或丢失由上层负责恢复
#### 有确认无连接的服务

- 使用前不建立连接，即**不建立数据链路**，但**每帧传输必须得到确认**
- 这在信号传播延时较大、线路状态不一定很可靠的情况下是有效的
- **例如：无线通信**
   - 如建立连接，则信道使用率很低
   - 然而，由于数据传输的误码率相对较高，所以确认是必要的
#### 有确认有连接的服务

- 使用前先建立连接，即**先建立数据链路**，并且**每帧的传输必须得到确认**
- 有连接的服务必须在使用前先建立连接（即建立数据链路），然后使用，最后释放连接
- 例如：电话 
   - 电话是一种实时的应用，如不是面向连接，则实时性难以得到保证
   - 电话是一对一的、双向的数据传输
### 帧的组成	了解
帧的组成必须保证能识别一个完整的帧，并保证一旦出现传输差错而导致前一个帧丢失时，也必须能识别后一个帧，即具有帧再同步能力
#### 字符计数法

- 假设帧的长度用一个字节表示，并作为帧的头部 
- 一旦帧长度计数被误读，将无法再同步，所以不能采用 
#### 带字符填充的首尾界符法 

- 这是一种面向字符的帧格式，所传输的数据都是字符（ASCII或EBCDIC字符），但帧中不允许出现帧界符标志，在**面向字符的串型通信中常使用**这种格式(PPP)
- 接收方一旦丢失了一个FLAG，只要继续搜索下一个FLAG，就可重新确定帧边界，即**具有再同步能力**
- 面向字符的帧格式不适宜传输数据中包含二进制数的帧，因为在包含二进制数的帧中很可能出现与FLAG相同的bit序列（通常FLAG用ASCII字符7EH定义）
- 一种方法是在二进制数中偶然出现的FLAG前再插入一个ESC （ASCII字符1BH），这种方法称为字符填充法 
#### 带位填充的首尾标志法 

- 这是一种面向二进制位的帧格式，把所有需传输的数据（不论是字符或表示一个浮点数的二进制位串，还是一个MP3的文件）一字排开，并以特殊的位模式01111110作为帧标志，即一个帧的开始（同时标志前一个帧的结束） 
- 如果由于干扰，一个帧标志没有被正确接收，则继续扫描接收串，一旦扫描到01111110，即新的一帧从此开始，即**具有再同步能力**
- **在面向二进制位的同步串行通信中常使用带位填充的首尾标志格式，如HDLC**
##### 面向bit的帧格式

- 当帧中出现一个与帧标志相同的位串01111110，则在连续5个1后自动插入一个0，即变成01111101，接收方将自动删除第5 个1后的0
- 这称为位插入法，也称为**透明传输**
#### 物理层编码违例法 

- 在曼切斯特编码中，连续高电平或连续低电平可用作帧界符 
- 高-高电平对和低-低电平对没有使用，如在二进制编码中出现则称为编码违例，但这两种违例编码正好可用作帧界符，在**令牌环网中**使用编码违例格式
### 差错控制	CRC 码计算过程	计算题

- 任何一个k位的帧都可看成为一个k-1次的多项式M(x)的系数列表
   - 如：1011001看成是多项式x6+x4+x3+x0的系数列表
- 设定一个生成多项式G(x)，G(x)为r阶，k>r
- 如xrM(x)/G(x) = Q(x) + R(x)/G(x) 其中Q(x)为商、R(x)为余数，R(x)即为M(x)的CRC码
- 将CRC码接在帧后一起发送，即发送数据为xrM(x) + R(x) 
- 二进制运算中，减法和加法都做异或运算：0+1=1,1+1=0 
- 因为( xrM(x) - R(x) )一定能被G(x)整除，即余数为0，则接收方只要计算CRC，并所得余数为0即为正确
### 流量控制的作⽤

- **发送速率和接收速率的匹配即流量控制**
- 如接收方的处理能力低于发送方，即使传输中没有出错，也可能被“ 淹没”，所以通常在接收方的缓冲区到达一定量时，应及时通知发送方，暂停发送，等候通知，这就是流量控制机制
### 6 个协议	不需要看伪代码
#### 三个基本数据链路协议（协议1-3）
##### 无限制的单工协议（协议1）
	一种理想的环境，理想的协议，假定：

- 链路是理想的传输通道，所传输的任何数据既**不会出错也不会丢失**
   - 即：不需校验，也不可能出现重发，毋需差错控制
- 不管发送方以怎样的速率发送数据，**接收方都能及时接收并处理**
   - 即接收端处理器的处理速度无限高，处理时间可忽略不计，缓冲区空间无限大，毋需流量控制
##### 单工的停 – 等协议（协议2）
	协议1中第一个假设保留，第二个假设撤消，假定：

- 链路是理想的传输通道，所传输的任何数据既不会出错也不会丢失	
- 考虑实际情况，接收方不可能具有足够高的CPU处理能力来及时处理所有的接收帧，也不可能具有永不溢出的缓冲区
- 即：**毋需差错控制，但必须进行流量控制**

这里的单工，其实是半双工，所谓流量控制是发送方必须收到前一帧的确认后才允许发送下一帧，接收方发出确认，意味着前一帧已接收并交网络层，准备接收下一帧

- 协议2是一个半双工协议，即发送方和接收方使用同一信道，但发送方发送数据帧的过程和接收方发送确认帧的过程是**严格交替**的
- 协议2中，发送方发送的数据帧和接收方发送的确认帧采用相同的帧格式，**发送方发送的数据帧中仅包含数据**，**接收方发送的确认帧数据为空**，仅为一个信号
- 由于协议2定义的是一个理想的传输通道，所以不考虑传输差错问题
##### 噪声信道的单工协议（协议3）
###### 噪声信道的差错控制

- 帧的数据出错：	帧数据中若干位出错， 通常CRC都能检测到 
- 帧的丢失：	一旦帧头出错，则该帧丢失
- 帧的重复：	如发送方有重发机制，当接收方发出的ACK丢失时，接收方将收到发送方重发的重复帧 
###### 采用定时器实现差错控制

- 如在协议2的基础上**增加一个重发定时器**，当发送方发送完一帧后启动一个重发定时器并等待确认
- 无论是由于接收方收到一个错帧而不发ACK（无否定性确认机制），还是由于帧标志错而导致帧的丢失，接收方不可能发送ACK，或者接收方所发送的ACK丢失，发送方的重发定时器都将超时，重发定时器一旦超时则立即重发，以实现差错控制
###### 简单的重发机制存在的问题 
```
- 效率较低
    - 接收方会收到重复帧
```
###### 较为实用的噪声信道单工协议

- 这里的噪声信道单工协议，其实是噪声信道半双工协议
- 协议3的帧格式中定义一个帧序号字段
- 发送方要记录下一个准备发送的顺序号
- 接收方要记录下一个期待接收的顺序号
- 由于是半双工噪声信道，发送和接收过程将严格交替 
- 协议3只定义了肯定性确认帧ACK，而没有定义否定性确认NAK
- 接收方收到一个正确（CRC正确）的帧，即便不是所期待的帧（即重复帧），都必须发送一个确认帧ACK
###### 协议3中帧格式

- 帧类型：有数据帧DATA 和确认帧ACK（肯定性确认）两种类型
- 帧序号：仅一个bit，在发送方的数据帧中是该帧的序号0/1，在接收方的确认帧中是接收方期待接收的下一帧的序号1/0
#### 三个滑动窗口协议（协议4-6）
##### 一位滑动窗口协议（协议4）

- **发送窗口WT=1，接收窗口WR=1**
- A和B之间的通信是双向的，A和B都正运行一个滑动窗口协议，其中包含了发送和接收的功能
- 帧序号仅用1bit表示，A和B的发送窗口WT=1、接收窗口WR=1，窗口大小即缓冲区的个数
- 发送方发送下一个数据帧必须在收到接收方的确认之后
- 接收方采用**捎带确认**，并假设需确认时，接收方总能从网络层取到待发送的数据，以便捎带确认
- 凡接收到一个正确的帧，即便不是所期待的帧（可能是重复帧），也必须发一个确认

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391431989-c8e76985-a541-4ba7-9936-e225c53644c5.png#averageHue=%23afd8e3&clientId=ued772dcd-aa97-4&from=paste&id=ufdc1fc08&originHeight=693&originWidth=929&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u9e54e4fc-b7b8-4881-9c63-072f7c43e68&title=)
##### 后退n帧的滑动窗口协议（协议5）

- 发送窗口WT=2n-1，接收窗口WR=1
- 协议4的主要问题是**信道利用率太低**
   - 发送端等待发送下一帧的时间至少是发送端到接收端信号传播时间的两倍，没有充分利用两条信道的传输能力
- 信道的利用率定义为
   - 数据发送时间/从数据开始发送到ACK返回的总耗时
- 协议5是一个发送管道化（pipelining）的协议
   - 在等待ACK的时间内连续发送
- 由于接收窗口为1，出错后重发必须后退n帧
   - 一旦**重发定时器超时**，必须将已发的**n帧全部重发**

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391432124-261f3483-4dc9-4405-8ec9-575eadbbd1b5.png#averageHue=%23b2dbe5&clientId=ued772dcd-aa97-4&from=paste&id=u36623177&originHeight=638&originWidth=888&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u9933cdc7-4c3b-43f3-ad94-ccc786e4957&title=)

- 设帧序号由3个bit表示，即0 ~ 7，并且WT = 7 , WR = 1
- 设发送方有大量数据待发送给对方，由于WT = 7，即有7个发送缓冲区，所以可连续发送7帧，并每发送一帧将启动一个重发定时器，但缓冲区的覆盖（窗口的旋转）必须在收到ACK之后，因为一旦该帧的重发定时器超时，必须将原缓冲区内的帧重发
- 接收方采用**捎带确认**，并假设需确认时，接收方总能从网络层取到待发送给发送方的的数据，以便捎带确认(piggybacking)
- 由于接收方的WR = 1，**如期待接收的帧出错**，则**丢弃此帧及以后所有收到的帧**，**不发确认**（无NAK机制）
- 当发送方出现超时（错帧的TimeOut）后，重发自该帧起的所有已发送帧（在当前的缓冲区中），如发送方连续发送了7帧（2 ~ 8），而2#帧无确认，超时后，必须从2#帧起全部重发
##### 选择性重发的滑动窗口协议

- 在差错率较高的信道上，使用协议5可能导致大量的重发，从而使信道利用率大幅度降低
- 协议6是一个选择性重发的滑动窗口协议
- 发送方可根据所定义的发送窗口大小，连续发送

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391432098-61036ada-e3f1-4f2e-9e74-03e3f5489e0f.png#averageHue=%23b1dbe5&clientId=ued772dcd-aa97-4&from=paste&id=uf35e02c8&originHeight=612&originWidth=925&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u382a5296-f18d-40bc-92eb-1c1b12fcce8&title=)

- 设帧序号由3个bit表示，即0 ~ 7，并且假设WT = 4 , WR = 4
- 设发送方有大量数据等待发送给对方，由于WT = 4，即有4个发送缓冲区，所以可连续发送4帧，并每发送一帧将启动一个（带帧序号的）重发定时器，但缓冲区的覆盖必须在收到确认之后，因为一旦该帧的重发定时器超时，必须将原缓冲区内的帧重发
- 协议6中，由于接收方的WR = 4，如期待接收的帧n#丢失，然而对后继到达的正确的 (n+1)#帧可照常接收，由于(n+1)#帧正确接收，也需要确认，但此确认应有别于对正期待帧的确认，这就是肯定性确认ACK和否定性确认NAK的区别，但无论是ACK或NAK，其中的确认号都必须为n，即期待接收的第n帧
- 协议6中定义了一个否定性确认的帧格式
   - 当接收方接收到一个有问题的帧时（包括两种情况：1. **CRC校验错**；2. **CRC校验正确但帧序号错**），发送一个否定性确认NAK
- 协议6中接收方定义了一个**辅助定时器**
   - 接收方采用捎带确认的前提是有数据帧发送给发送方，然而并非需要捎带确认时，接收方上层总是有数据需发送的，所以接收方定义了一个辅助定时器，凡收到一个正确的数据帧并需发送确认时，立即启动辅助定时器，在辅助定时器溢出前，上层有数据帧发送，则可捎带确认，如辅助定时器溢出，则立即发送一个单独的确认，以免发送方的重发定时器超时而导致的数据帧的重发
###### 当WT=WR=7时协议6失败的原因

- 原因在于接收窗口过大，窗口中的有效顺序号在调整前和调整后有重叠 
- 所以，通常：**发送窗口+ 接收窗口 <= 2n**
   - 且：**发送窗口 = 接收窗口**
- 发送窗口 > 接收窗口或者发送窗口 < 接收窗口都是不合适的
###### 协议6更具实用性

- 协议6中：如果帧序号由n位组成，即0 ~ 2n - 1
   - 发送窗口 = 接收窗口 = (MAX_SEQ + 1) / 2
- 协议6中：增加了否定性确认NAK，其中的确认号为当前所期待接收的帧的序号
   - 当收到一个CRC校验错的帧，则发一个NAK
   - 当首次收到一个CRC校验正确、但序号错的帧，则发送一个NAK
- 协议6中：增加了一个辅助定时器，当辅助定时器超时，则立即发送一个ACK，其中的确认号为当前所期待接收的帧的序号
   - 当收到一个CRC校验正确、序号也正确的帧，即正是所期待的帧，将启动一个辅助定时器（为等待捎带）
   - 当再次收到一个CRC校验正确、但序号错的帧，因为已发送过NAK ，所以不再发NAK，此时也将启动一个辅助定时器（为等待捎带）
### HDLC 的帧类型	选择填空
#### 信息帧Information Frame 

- P/F（Poll/Final）位：
   - P 主机查询哪个终端要发送数据
   - F 终端发送数据的最后一帧用F
- 捎带确认帧号：
   - 即**下一个期待接收帧号**，意味着以前的帧的接收确认

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391432101-e5a8ab44-9bb3-4bdd-b750-869293c0d8fb.png#averageHue=%23b1d6de&clientId=ued772dcd-aa97-4&from=paste&id=u3bd7a32b&originHeight=95&originWidth=849&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u6160a53b-ea1b-4f1b-b03f-c4169dd458e&title=)
#### 监控帧Supervisory Frame 

- RR（Receive Ready）：**接收准备好**即确认Next-1及Next-1帧以前的所有帧，并准备好接收Next帧 
- RNR（Receive Not Ready）：**接收未准备好**即确认Next-1及Next-1帧以前的帧，并要求发送方停止发送 
- REJ（REJect）：**拒绝接收**即否定性确认，确认Next-1及Next-1帧以前的所有帧，并要求重发Next及Next以后的所有帧 
- SREJ（Selective REJect）：**选择性拒收**即否定性确认，确认Next-1及Next-1帧以前的所有帧，但仅要求重发Next帧	（此类型在SDLC及LAPB中不允许） 

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391432513-32761183-d9c0-448a-95f5-08e10242602c.png#averageHue=%23c2e3e5&clientId=ued772dcd-aa97-4&from=paste&id=u3e7f0725&originHeight=413&originWidth=872&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=uc3d0d3a5-d12e-4751-bcdb-4211e43e921&title=)
#### 无序号帧Unnumbered Frame 

- 控制字段的1、2 bit都为1的帧为无序号帧
- 无序号帧**用于控制链路本身**，如呼叫、确认和断开连接等控制
- 在无序号帧中用5位（3，4，6，7，8）来表示无序号帧的类型，但32种可能的类型中有些是保留的，并且，不同的协议中，无序号类型区别很大 （略）
### PPP 协议过程	了解

- 发送端PPP首先发送LCP帧，以配置和测试数据链路 
- 在LCP建立好数据链路并协调好所选设备之后，发送端PPP发送NCP帧，以选择和配置一个或多个网络协议 
- 当所选的网络层协议配置好后，便可将各网络层协议的分组发送到数据链路上 
- 配置好的链路将一直保持通信状态，直到LCP帧或NCP帧明确提示关闭链路，或有其它的外部事件发生（如用户干预等） 
#### LCP （Link Control Protocol）
提供了建立、配置、维护和终止点对点链接的方法 
#### 网络控制协议（NCP）簇
支持各种网络层协议
#### 一次使用PPP协议的过程 

1. 初始状态 
2. 建立连接：建立成功到3)，否则到1) 
3. 选项协商：协商成功到4)，否则到7) 
4. 身份认证：认证成功到5)，否则到7) 
5. 配置网络：网络配置完后到6) 
6. 数据传输：数据传输完后到7) 
7. 释放链路：回到1) 
## 第四章：介质访问⼦层
### 信道共享	动态	受控接⼊	选择填空
#### 信道的动态分配

- 将整个物理媒体看成一条信道，所有连在媒体上的站点之间都是通过这条信道传输。
- 主要问题：信道争抢
#### 信道的动态分配:受控接入协议

- 轮询：由中心控制器循环扫描每个站点，给每个站点一次发送的机会
- 预约：每一轮分组的发送都是事先安排好的
- 令牌传递：把计算机连成一个环，环中有一个特殊的称为令牌的报文在传递。拿到令牌的站点可以把令牌扣下，并发送报文
- 缺点：需要一个特殊的设备来协调这些过程
### 分时隙	侦听假设（信道动态分配的五个假设）
#### 时间分时隙（Slotted Time）
时间被分为时隙，帧只能在时隙的开始处发送，一个时隙中可发送0、1或多帧，在一个时隙的开始处，如果只有一个站点发送则成功，如有多个站点发送则将发生冲突
#### 侦听假设

- 载波侦听（Carrier Sense）
   - 所有的站在使用信道前，都可检测到当前信道是否正被使用，如信道正忙，则等待
- 非载波侦听（no Carrier Sense）
   - 所有的站在使用信道前，都不检测当前信道是否正被使用，只是盲目发送

在局域网中，常采用载波侦听
### 多路访问协议
#### 纯ALOHA的原理

- 任何一个站都可以在帧生成后立即发送（可能冲突） 
- 通过信号的反馈，检测信道，以确定发送是否成功
- 如发送失败，则经随机延时后再发送 

在纯ALOHA中，站点一旦产生新帧则立即发送，如果一个标准长度的帧的发送时间为t，在t0+t时刻允许生成一个新帧，除此新帧之外，在t0 ~ t0+2t 时间内不能有其它帧产生，否则冲突，即冲突危险区为2t
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391432642-b1889322-ce62-439a-a259-e15d49c05341.png#averageHue=%23b7e1eb&clientId=ued772dcd-aa97-4&from=paste&id=u05d065e1&originHeight=216&originWidth=755&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u87977703-235b-4174-9e06-b31e4155617&title=)

- 当网络比较闲时，效率较好
- 当网络较忙时，会频繁发生冲突。这种冲突时的信道的利用率只能达到18%
#### 分隙ALOHA的原理 

- 在一个时隙内只产生一个新帧，新帧不允许立即发送，将在下一个时隙的开始处 t0+t 时发送，不会发生冲突
- 在一个时隙内产生一个以上新帧，下一个时隙的开始处 t0+t 时，一个以上的帧同时发送，将发生冲突，即冲突危险区为t
- 分隙ALOHA的时间以时隙(Time Slot)为单位
- 时隙的长度对应一帧的传输时间，其起点由专门的信号来标志 
- 新帧的产生是随机的，但分隙ALOHA不允许随机发送，凡帧的发送必须在时隙的起点，即冲突危险区是原来的一半
- 信道利用率可达36%

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391432643-5fcd7995-3444-4d32-9e68-e282365c33dc.png#averageHue=%23bfe6ed&clientId=ued772dcd-aa97-4&from=paste&id=u7eac688f&originHeight=475&originWidth=418&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u39d46202-f23f-432e-964d-0c0663e9461&title=)
#### 载波侦听多路访问协议CSMA
在发送数据前先侦听信道，只有当信道为空时才可能发送
见后面几个考点
### 1-持续	⾮持续	p-持续
#### 1 – 持续CSMA
每个站在发送前，先侦听信道，如信道正忙，则等待并持续侦听，一旦信道空闲，立即发送，即发送的概率为1；如冲突，则延时一随机时隙数后，重新发送 
#### 非持续CSMA（Nonpersistent CSMA） 
每个站在发送前，先侦听信道，如信道正忙，则不再继续侦听，而是延时一随机时隙数后，再侦听信道 
#### p – 持续CSMA（p-persistent CSMA）
用于分隙信道先侦听信道，如信道正忙，则等到下一时隙；如信道空闲，则以概率p发送，而以概率q=(1-p)把本次发送延至下一时隙，直至发送成功 
### 传播时延对载波侦听的影响
CSMA并不能完全解决冲突问题：如两个或多个准备发送的站都检测到信道空闲而同时发送将发生冲突
如一个站点发送并经2tao后，没有冲突，即发送成功典型地，一公里长的同轴电缆，tao=5us 2tao=10us 
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391432720-b13f8a53-3471-4d55-be57-fb87b2b2f3fc.png#averageHue=%23c1e5ee&clientId=ued772dcd-aa97-4&from=paste&id=uc65e566e&originHeight=269&originWidth=836&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=uc2a45a97-ec89-4195-b4f1-7c403fbec14&title=)

- 在一帧传输完成后的时刻t0，想要发送的站点都可以尝试发送 
- 如两个或多个站点同时发送则发生冲突 
- 判断出冲突后，立即停止发送，并延时一个随机时隙数后，通常其中的一个站点将发送成功 
### 以太⽹的发展	选择填空

- 802.3以太网：总线型 10M
- 快速以太网：100M
- 千兆以太网：1G
### mac 地址	理解⼀下
以太网的帧结构
#### 先导字段 

- 7个字节的10101010，实际上下一个字符也是先导字段，只是最后的两位为1，表示紧接着的是真正的MAC帧 
- 8个字节的10101010的曼切斯特编码将产生10MHz，持续6. 4us的方波，周期为0.1us，可用于时钟同步 
#### 两个地址 (目的地址和源地址)

- 目的地址和源地址都允许为2字节或6字节，在10M bps的基带以太网中是6字节 
- 目的地址最高位为0：普通地址 1：多点发送（Multicast）
- 目的地址全1：广播发送（Broadcast） 
- 在6个字节（共48位）的地址中有46位用于地址的指定，即有246＝7.03687x1013个地址
- 网卡地址是一个全局地址
   - 如：44-45-53-54-00-00 
#### 数据字段长度和校验和 

- 指明数据的字节数，数据字段长度允许为0 
- 4个字节共32位的CRC码 
#### 填充字段 

- 为保证帧的**最短长度为64个字节**
   - 即：在数据字段长度为0时 
   - 两个地址（12字节）+ 长度（2个字节）+ 填充字节+校验和（4个字节）= 64 
   - 8字节+ 填充字节 = 64 
   - 填充字节 = 46 
   - 所以填充字节为：0 ~ 46字节 
### 为什么帧的最短长度为64个字节 
为了确认发送帧是否正确到达目的站点，必须保证可能的冲突信号返回时帧的发送尚未结束，如在2tao 内没有冲突信号返回，则发送成功，如果发送端在2tao时间内帧已经发送结束，则即使冲突也无法检测，即最短帧长应与2tao相当 
### ⼆进制指数后退算法举例计算题

- 发送方在检测到冲突后，双方（或多方）都将延时一段时间，所谓一段时间到底是多长?
- 检测到冲突后，时间被分成离散的时隙 
- 时隙的长度等于信号在介质上往返的传播时间（在以太网中，一个时隙，即2 tao为51.2us ） 
- 一般地，经i次冲突后，发送站点需等待的时隙数将从0 ~ 2i - 1中随机选择 

在一个时隙的起始处，两个CSMA/CD站点同时发送一个帧，求前4次竞争都冲突的概率? 

- 第一次竞争冲突的概率为1；
- 第一次冲突后，A、B都将在等待0个或1个时隙之间选择，选择的组合有：00、01、10、11，共4种，其中00和11将再次冲突，所以第二次竞争时，冲突的概率为0.5
- 第二次冲突后：A、B都将在0、1、2、3之间选择，选择的组合有：00、01、02、03、10、11、12、13、20、21、22、23、30、31、32、33共16种，其中00、11、22、33将再次冲突，所以第三次竞争时，冲突的概率为0.25
- 第三次冲突后：A、B都将在0、1、2、3、4、5、6、7之间选择，选择的组合共有64种，其中00、11、… …、77将再次冲突，所以第四次竞争时，冲突的概率为0.125
- 前四次竞争都冲突的概率为：1 x 0.5 x 0.25 x 0.125 = 0.015625
### 物理层的设备、链路层设备

- 在物理层扩展：通过中继器
- 在链路层扩展：网桥、交换机
#### 网桥（Bridge）

- **网段**：也称为冲突域，是一个CSMA/CD的工作区域
- 网桥是一个连接多个网段的设备，每个端口连接一个网段
- 网桥监听每个端口，当收到一个完整的帧时，再把它发送到另一个网段上
- 网桥转发所有的多播或广播帧
- 由网桥连接起来的网还是一个局域网
- 各网段可独立工作
- 网桥是智能设备，只有当帧的源地址和目的地址处于不同网段时才转发 
- 网桥可扩大局域网的范围，不仅是距离，而且计算机数量也能扩大
- 网桥可以连接不同的局域网的网段
- 如把数据链路层细分为LLC子层和MAC子层，则所谓不同的局域网是指在数据链路层的MAC子层上 
### ⽣成树⽹桥

- 如在LANs之间为提高可靠性，并行连接有2台（或多台）采用逆向学习算法的透明网桥，则可能由于无限制的循环扩散而使流量骤增，最后导致网络瘫痪
- 从原理上说，如网络中存在回路，常规算法的透明网桥都不能正常工作
- 所谓生成树算法就是在物理上存在回路的拓扑中，生成一棵在逻辑上无回路的树，即生成树 
- 生成树算法将以某指定节点为根节点，构建一棵生成树
- 对于原包含回路的拓扑，从生成树的根节点出发，沿生成树，可以到达任意一个节点，却不包含回路，但不能保证其路径是最优的
### ⽹络互联设备
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391432834-18839164-142c-4edd-b53a-a557773ad6af.png#averageHue=%23b7dee7&clientId=ued772dcd-aa97-4&from=paste&id=u11c46b9d&originHeight=419&originWidth=641&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u2c1ba81c-e1f4-4a0a-b72f-e89fc9efa96&title=)
#### 以太网交换机

- 交换机有一个高速的背板，速率可达1G b/s或更高 
- 背板上可插入若干个模块（有的模块还可插入子模块） 
- 每个模块（或子模块）上有4 ~ 8个RJ-45的端口，甚至更多，每个模块实际上是一个规模较小的局域网，即**一个模块就是一个共享域**（以太网中，共享域即冲突域）
- 一个模块上任一时刻只能有一个站点发送，但分属不同模块上的端口可并行工作，这可理解为组交换：**模块内共享，模块间交换**
- 当每个模块都退化成只有一个端口时，即一个共享域中只有一个端口，则该交换机是**全交换的**
### 数据链路层	LLC 和MAC
逻辑链路控制LLC（Logical Link Control），即 IEEE 802.2标准
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391433060-690f794b-8481-40f1-92ee-4aa742956532.png#averageHue=%23b9e1eb&clientId=ued772dcd-aa97-4&from=paste&id=uf4be6630&originHeight=406&originWidth=888&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u00d0bc35-812b-49b1-8b09-c318e56c909&title=)
#### LLC的作用

- 由于不同的网络类型有不同的介质访问子层（MAC）与之对应，而逻辑链路控制子层LLC则**掩盖了不同物理网络之间的差别**，以统一的格式为网络层提供服务 
- LLC子层把网络层的分组（在TCP/IP中即 IP包）加上LLC头，交给MAC子层组成相应的802.X帧发送 
### ⽹段和⼦⽹

- 网段（**一个网段即一个冲突域**）
   - 将若干个网络（网段）通过交换机（网桥）连接，以增加网络内的主机数并扩大覆盖范围，交换机（网桥）的每个端口连接一个网段，**网段是链路层概念**
   - **一个网段内的主机为一个冲突域，所有的主机是一个广播域**，不同网段的主机间的通信则由交换机（网桥）负责转发或扩散
- 子网（**一个子网即一个广播域**）
   - 将若干个网络（子网）通过路由器连接，以实现网络的互联并组成一个更大的网络，路由器的每个端口连接一个子网，**子网是网络层概念**
   - 一个子网就是一个广播域，**子网间的通信必须由路由器控制**

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391433163-69a63bc5-9654-43fe-8e79-ecca5a9f183a.png#averageHue=%23b1dbe5&clientId=ued772dcd-aa97-4&from=paste&id=u90e4649f&originHeight=683&originWidth=960&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u2e0955ae-f561-420a-9766-44d82a4cf8e&title=)
### VLAN
VLAN是采用交换机技术，将原有网络分成若干个逻辑上的子网，逻辑子网也具有物理子网相同的网络性能，**一个VLAN是一个广播域**
#### VLAN基于交换技术

- VLAN技术属交换机的技术
- 交换机将维护一张**交换表**
- 交换表是交换端口的编号、MAC地址和所连接主机的MAC地址的关联表
- 交换表可以静态配置，也可以动态维护
#### VLAN的划分

- 按端口划分
- 按主机的MAC地址划分
- 按主机的IP地址划分
#### VLAN的技术特点

- **提高网络的可管理性**，便于建立虚拟工作组
   - 不同物理网络中的主机可定义在同一个VLAN内， 同一物理网络内的主机也可定义在不同的VLAN中
- **提高网络的安全性**
   - 不在一个VLAN中的主机，无法监听
- 有效地避免广播风暴，以**提高信道利用率**，并降低路由器的投资成本
   - 在一个物理网络（一个路由器端口连接的网络）内可划分多个逻辑子网
- 减少主机因网络逻辑拓扑改变而在物理上的移动
### 802.11 标准
#### 802.11的组网模式
##### Ad-Hoc 模式

- 所有的移动站之间互相平等，每个节点既是主机又是路由器
##### 	
##### Infrastructure 模式	基本服务集合 BSS
	![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391433246-52aa1ecd-097c-4461-ad2a-005ca3c9817d.png#averageHue=%23c0e2f1&clientId=ued772dcd-aa97-4&from=paste&id=uaf3b7bc1&originHeight=653&originWidth=933&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=uf3c3c484-4650-4d0d-ae39-22425cffb07&title=)
##### Infrastructure 模式	扩展服务集合 ESS
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391433309-32324b57-dbfe-47d4-ac65-73fba3562a0c.png#averageHue=%23c3e4f4&clientId=ued772dcd-aa97-4&from=paste&id=u78a123c6&originHeight=634&originWidth=897&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=ub1a66be4-874a-4f31-ac58-6a10a85f212&title=)

- 	ESS：Extended Service Set 扩展服务集合
- 	由多个BSS通过一个分布式系统DS（Distribution System）互联而成，就像一个逻辑上的局域网
- 	一般来说，DS是一个有线主干局域网，通常表现为以太网
- 	BSS之间的通信将通过DS实现，BSS在LLC子层上相统一，至此，一个移动主机可以漫游在不同的BSS之间
#### 802.11物理层

- FHSS 跳频扩频 ：使用2.4G（24000- 24835GHz）的ISM频段。有79个信道供跳频使用，每个频道带宽1MHz。若用标准的调频，则有1Mb/s。
- DSSS 直接序列扩频：也用2.4G的ISM频段
- 红外线IR：用于室内传送数据，接入速率1- 2Mb/s
- OFDM 正交频分复用：工作在5GHz频带，可以使用的速率为6，9，12，18，24，36，48，56Mb/s
- 使用工作在2.4G的DSSS，数据率为5.5或11Mb/s
#### 802.11的MAC层协议栈
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391433368-fc0731d4-d009-46e8-bf3c-e713cc78862e.png#averageHue=%23b9dfe8&clientId=ued772dcd-aa97-4&from=paste&id=ub4d176b6&originHeight=342&originWidth=927&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u3c3c848d-2b1a-4015-9669-08227ce440a&title=)
##### DFC分布式协调功能

- DCF模型中每个站点都是相互独立的，没有主从关系，如同在Ethernet中一样，必须通过竞争获得信道
- DCF采用CSMA/CA，即**带冲突避让**的载波多路侦听CSMA/CA：CSMA with Collision Avoidance
###### DCF的其他功能

- 对信道进行预约
   - 为了保证长帧的正确传输，可以在传输前先预约信道，**告诉其他站点不得发送数据**，以防止长帧在传输过程中发生碰撞
   - 源站A在发送数据前先发送一个**控制帧RTS（请求发送）**，它包括源地址、目的地址和所需时间。若信道空闲，目的站B发回一个**控制帧CTS（允许发送）**。A收到CTS后就可开始发送数据帧。
- 虚拟载波侦听
   - 802.11的帧头中有一个字段是持续时间，表示当前帧所需发送的时间
   - 正在侦听的这些站只要看到这个字段就知道信道忙的时间（包括发送确认的时间），使他们在这一段时间都停止发送
   - 实现方式：源站将所需时间填入MAC帧的“持续时间”字段中，其他站根据该字段值调整自己的网络分配向量NAV。NAV指出需要多少时间才能使信道转为空闲
##### PCF点协调功能

- 接入点对基本服务组内的站点实施控制，以确保传输不会相互干扰
- 例如，接入点可以为每个站点分配一个独立的频率或由AP轮询各站点
### CSMA/CA 	为什么
#### CSMA/CA
DCF采用CSMA/CA，即**带冲突避让**的载波多路侦听CSMA/CA：CSMA with Collision Avoidance

- 报文发送之前侦听信道（CSMA相同）
   - 如果忙，用二进制指数后退选择一个值，继续侦听。当听到信道为空时，开始发送
   - 不忙，则发送
- 发送前，先等待一个**很短的称为帧间间隔的时间**，再等待二进制指数后退选择的时间，然后才发送
- 发送后不检测冲突。数据是否发送成功是由ACK报文完成。如发送方没有收到ACK，就认为报文丢失了，并采用二进制指数后退算法
- 与以太网不一样的是第i次后退是从22+i个时隙中选取一个
- 任何站在发送下一帧前必须等待一段很短的时间，这段时间称为帧间间隔IFS(InterFrame Space)。
- 当信道从忙转为空闲时，任何站在发送数据前，都要采用二进制后退算法减少发生冲突的概率。
#### 帧间间隔IFS

- 无线局域网定义了几种不同的帧间间隔
- 高优先级的帧间隔时间短，低优先级的帧间隔时间长
- 当有多个站点同时发送数据时，保证高优先级的能先发送
- SIFS：短帧间间隔，长度为28μs，用来分隔一次对话的各帧。使用SIFS的帧类型有ACK、CTS、RTS和长的帧分片后的数据帧以及所有回答AP探寻的帧和在PCF方式下AP发出的任何帧
- PIFS：比SIFS长。为了在开始使用PCF方式时优先获得接入到媒体中。它的长度是SIFS加一个时隙，为78 μs。
- DIFS：最长的IFS。用在DCF方式中发送数据帧和管理帧。长度为PIFS加一个时隙，为128 μs
#### 无线局域网为什么不能使用CSMA/CD?

- CSMA/CD要求每个站点在发送数据的同时还必须**不间断地检测信道**，而**在无线局域网的设备中要实现这个功能花费过大**
- 即使发送端能够实现碰撞检测，在接收端**仍可能发生碰撞**
### 信号发送半径	两个错误判断
#### 信号发送半径引起的错误判断 1
A发送报文给B，但因C在A的信号范围之外，C没有察觉A的发射信号，如果C同时也发报文给B，则会干扰B对A信号的接收。这个问题称为**隐藏站点的问题**。
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391433660-785eb969-86a2-4316-b2e8-0096a5534d0b.png#averageHue=%23b4dfe9&clientId=ued772dcd-aa97-4&from=paste&id=u242ffa5f&originHeight=293&originWidth=571&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u9113959c-5a44-4a35-bbed-c571817b5fb&title=)
#### 信号发送半径引起的错误判断 2
如果B正发送报文给A，C也暴露在B的发送信号范围之内，如果此时C希望发送报文给D，但由于C检测到信道上有信号，就不会发送，其实，此时C发报文给D应该是没有问题的。这个问题称为**暴露站的问题**
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391433710-ec6c5520-e460-4637-8f50-1b7afd4bf038.png#averageHue=%23b3dee9&clientId=ued772dcd-aa97-4&from=paste&id=u0621c0db&originHeight=311&originWidth=448&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u7822555c-ab95-4fc1-84e1-641328a8fef&title=)
## 第五章：⽹络层
### ⽹络层主要解决的问题

- 路由选择
- 网络互连
- 拥塞控制
- 为上层提供服务
### 路由算法	选择填空

- 路由算法设计必须考虑的问题
   - 正确性 简单性 健壮性 稳定性 公平性 最优性
- 路由算法中的度量标准
   - 路径长度
   - hop数
   - 延迟时间
#### 路由算法的分类

- 静态算法
   - 最短路径算法（Dijkstra）
      - 通过用边的权值作为距离的度量来计算最短路径，有最少边数的路径不一定是最短路径 
   - 扩散法（flooding）
      - 不计算路径，有路就走
      - 缺点：重复数据包多，浪费带宽 
      - 优点：可靠性高，路径最短，常用于军事 
- 自适应算法：自适应算法是动态的、分布式的算法
   - 实现分布式算法的三要素：
      - 测量
      - 更新协议
      - 计算
   - 距离矢量算法（D-V）
   - 链路状态算法（L-S）
- 拓扑相关的路由算法
   - 分层路由
   - 广播路由
      - 多目的地路由 
         - 分组中包含需到达的多个目的地的地址表 
         - 到一个节点时，路由器检查所有的目的地址表，确定输出线路集合，路由器为每一条输出线路复制一个新的分组，每个分组中仅含有要用此线路的目的地址表
         - 优点：流量小，节约带宽 
         - 缺点：费用承担不公平
      - 生成树算法
      - 逆向路径传送 
         - 基本原理：当某一广播分组到达路由器时，路由器对它进行检查，如该分组来自通常向广播源发送分组的线路，则将该分组转发到除进线以外的其它线路，否则丢弃 
   - 多址传输路由选择
      - 生成树法
      - 核心树(core-based tree) 
   - Peer-to-Peer网的节点查找 
- 移动节点的路由
- Ad-hoc网络的路由
### ⾃适应算法（D-V）	重点	计算题

- 每个路由器用两个向量Di和Si来表示该点到网上所有节点的路径距离及其下一个节点
- 相邻路由器之间交换路径信息
- 各节点根据路径信息更新路由表 

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391433810-c5a177b0-9456-4fd6-a0f3-9edb619fd543.png#averageHue=%23add7e2&clientId=ued772dcd-aa97-4&from=paste&id=u60424d1c&originHeight=741&originWidth=987&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u030dd94c-0f16-45b6-8e41-83c9a55881c&title=)
缺点

- 交换的路径信息量大
- 路径信息不一致
- **收敛速度慢**（坏消息）
- **不适合大型网络**
### L-S 算法	了解基本思想
基本思想：

1. 发现它的邻接节点，并得到其网络地址
2. 测量它到各邻接节点的延迟或开销
3. 组装一个分组以告知它刚知道的所有信息
4. 将这个分组发给所有其他路由器
5. 计算到每个其他路由器的最短路径
- LSR的优点
   - 路由信息的**一致性好**，坏消息也一样传播得快
   - 状态分组的长度较短，仅包含到邻接点的距离、序号和年龄等，与网络规模关系不大，传输所耗用的网络带宽不大，此外，状态分组的扩散，由于年龄参数的设定，不会无限制扩散，所以**可适用于大型网络**
- LSR的缺点
   - 每个路由器**需要有较大的存储空间**，用以存储所收到的每一个节点的链路状态分组
   - **计算工作量大**，每次都必须计算最短路径
### 分层路由的好处特点
随着网络规模的增长，存储和处理路由表所需的资源也急剧增长，从拓扑上分层是解决问题的一个方法
分层的概念：将路由器分成组，每一路由器知道到组内任何一台路由器的路由，以及到其他组的路由，因此可把其他组中所有的路由器抽象成一个，以**减少路由表的长度**
### ⽣成树算法（广播路由算法）

- 路由器将分组沿生成树发送（除进入线路之外）
- 优点：带宽得到最佳利用 
- 缺点：每个路由器必须知道其可用生成树
- 如链路状态路由算法可得到生成树，距离矢量路由算法却不能得到
### IPv4 和IPv6 	特点	⼯作机制
#### 移动IPv4

- 移动IP技术，是移动用户在跨网络随意移动和漫游中，不用修改计算机配置的IP地址，享有原网络中一切权限。
- 支持主机移动或漫游的协议是Mobile IP协议
- Mobile IP协议中定义了**三种功能实体**：
   - 移动节点：一个移动的计算机，它改变位置时无需更改其IP设置，仍然可以通过其固定的IP地址进行通信。
   - 主代理：一个移动节点本地网络的主机或路由器，它保存有移动节点的位置信息，当移动节点离开主网络时能够将发往移动节点的数据包传给移动节点。
   - 客代理：移动节点当前所在的外地网络上的一个主机，它能够把由主代理送来的数据包转发给移动节点。
- 移动IP的工作机制
   - 代理**周期性地发送广播**，宣告他们与链路之间的关系
   - 移动节点收到这些广播后，判断自己是在本地网还是在其他网。
   - 如在其他网：
      - 移动节点向客代理注册，递交自己的IP地址，MAC地址和一些安全信息
      - **客代理与主代理联系**，报告自己的网络地址
      - 主代理告诉客代理接收此消息
      - 客代理保存此移动主机的信息
   - 当有一个包发给移动主机时
      - 首先，该包会路由到主网络
      - 主代理查找到了移动主机的新住址，以及客代理的地址。
      - 把此包再封装在一个IP包中，发给客代理
      - 告诉发送者将包直接发给客代理
      - 客代理解封装数据包，把此数据包用数据链路层协议传给移动主机
#### 移动IPv6

- **无客代理**
- 同时支持隧道和源路由技术
- 主要内容
   - 移动主机在外地网上获取一个转交地址
   - 将转交地址通知主代理和他的通信伙伴
   - 知道转交地址的伙伴可直接发送信息
   - 不知道转交地址的伙伴可发送给主代理，由主代理再发送到转交地址
### ⽤赛控制	开环控制闭环控制	选择填空

- 当通信子网中有太多的分组，导致其性能降低，这种情况叫拥塞 
- 拥塞控制和流量控制的区别
   - 全局性问题和局部性问题
- 造成拥塞的原因
   - 节点存储容量（缓冲区）不够
   - 处理机速度太低 
   - 线路容量（带宽）不够 
#### 拥塞控制的基本原理 
##### 开环控制

- 通过良好的设计来避免问题的出现，确保问题在一开始就不会出现
- 开环控制的方法：
   - 什么时候接受新的数据报
   - 什么时候开始丢弃分组，丢弃哪些分组
   - 制定网络中各个节点的调度策略
- 所有这些**决定与网络中的当前状态无关**
##### 闭环控制 

- 建立在反馈的基础上，由三部分组成：
   - 监视系统，检测何时何地发生了拥塞
      - 检测的指标可以是包丢失率、平均队列长度、由于超时引起的重发包数和数据包延迟抖动等
   - 将此信息传送到可能采取行动的地方 
      - 直接发包给相关节点
      - 利用包中的某一bit将拥塞通知邻居节点
      - 每个节点周期性地发出探测报文
   - 调整系统操作以更正系统
- 显式反馈：当某一节点发现拥塞时，它**发一个回答帧给相关节点**，通知它们网络拥塞了 
- 隐式反馈：通过定时器方法，发送端每发一个帧，就启动一个定时器，如在**规定的时间内没有收到相应的ACK**，则认为该帧丢失，如丢失率相当高，则认为网络发生了拥塞 
- 闭环控制一般**不适合于高速网**
- 因为等反馈的控制信号到达，早已时过境迁
### 服务质量指标	不同服务需要的不同质量	选择题
#### 服务质量的指标

- 从同一源到同一目的地的一串分组流（stream）称为流（flow）
- 流的服务质量有四个指标
   - 可靠性
   - 延迟
   - 抖动
   - 所需带宽
#### 不同的服务需要不同的质量
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391433932-0520c9e6-ec60-49b1-9ca2-0641105f9e6e.png#averageHue=%23b1d8e2&clientId=ued772dcd-aa97-4&from=paste&id=u6a1b5427&originHeight=526&originWidth=839&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u46a96991-e079-4546-bf2e-4364a282187&title=)
### 流量整形	计算题	重点
#### 漏桶算法（Leakey Bucket Algorithm） 
平滑输入流量，控制进入网络的流量 

- 设C为漏桶容量 （Byte, cell数）
- p为漏桶的输出速率（Byte/s）
- 则突发速率r与允许突发时间的长度S的关系为： ![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391433982-5d6c8555-44a5-4756-8235-a321a5c42af3.png#averageHue=%23f4f4f4&clientId=ued772dcd-aa97-4&from=paste&id=ud19c319a&originHeight=115&originWidth=172&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u3933a88c-f737-4e9d-afe0-91fc5ab5aff&title=)

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391434139-fa3177dc-dcf2-4714-b22a-1ae15d50aa6b.png#averageHue=%23b4dce6&clientId=ued772dcd-aa97-4&from=paste&id=ueb373c50&originHeight=534&originWidth=789&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u45f1284a-2609-4d22-b4d2-af146352300&title=)

- 漏桶算法的不足之处
   - 漏桶满时，造成数据丢失 
   - 漏桶算法强迫输出保持一个固定的平均速率，不能体现通信量的突发 
#### 令牌桶算法(Token bucket Algorithm) 
希望当大的突发流量到来时，输出也能有适当响应 

- 数据的输出必须持有令牌
- 令牌的产生是定时的，每隔Δt，产生一个令牌，如令牌没有被及时使用，可以存在令牌桶内，令牌桶满则将被丢弃 
- 当突发数据到达时，如令牌桶内有多个令牌，则突发数据可按令牌数输出 

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391434176-63c37927-245c-4c53-875b-c067d871aa1c.png#averageHue=%23b2dae4&clientId=ued772dcd-aa97-4&from=paste&id=uceffc8b6&originHeight=642&originWidth=822&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=ud3170cf0-9803-42a3-aa8b-d320bb2062a&title=)
### 互联⽹络的路由	分段

- 将网络分成一个个的AS（autonomous system 自治系统），AS之间由路由器连接 
- 每个自治系统受单一管理机构控制，由一组网络构成 （如校园网就是一个AS ）
- AS中由内部网关协议IGP（Interior Gateway protocol）处理 
- AS间由外部网关协议EGP（Exterior Gateway protocol）进行处理 
#### 分段

- 每个报头都包含三个字段： 
- 分组号、偏移量和分组结束标志
#### 重组

- 透明分段——在入口网关分段，由出口网关重组
   - 出口网关必须知道什么时候本分组的所有分段都已收到，并必须对每个分段进行存储，此外所有分段必须汇集到出口网关 
- 非透明分段——由目的主机重组
   - 要求每一主机都有重组功能，由于每个分段都必须增加一个头部，所以增加了每一分组的开销
### 因特⽹技术点	选择

- 使用TCP/IP协议 
- 网络互联结构：各网之间一般采用路由器加专线连接 
- 层次结构的域名及网络管理 
- 分布式的管理模式，没有一个Internet管理中心 
- 开发了通用的应用技术
### IP 地址	必考
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391434422-aa616c5f-a2ca-49f1-b10a-cb4a04a1fc01.png#averageHue=%23afd9e3&clientId=ued772dcd-aa97-4&from=paste&id=u72b3d012&originHeight=716&originWidth=906&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u9fc3dc00-823d-4a90-b407-4884377634c&title=)
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391434408-ca4b5766-9a5f-4bce-bc94-af70d234463b.png#averageHue=%23aed8e3&clientId=ued772dcd-aa97-4&from=paste&id=u623e210a&originHeight=686&originWidth=943&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=ufd4f21a4-7590-4c64-a90a-e5ac3aa8482&title=)
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391434500-38617841-b8a4-4b47-8b32-065a7f68c07a.png#averageHue=%23b2dbe5&clientId=ued772dcd-aa97-4&from=paste&id=udc70b6ea&originHeight=607&originWidth=846&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u031d8033-4fa2-4bce-822c-4c63890c0bb&title=)
### ⼦⽹掩码	重点	怎么划分⼦⽹	计算题
#### 子网掩码

- 子网掩码的作用
   - 因为子网地址长度不是固定的，所以必须说明设备地址中的哪一部分是包含子网的网络地址段，地址中哪一部分是主机地址段
- 子网掩码使用与IP编址相同格式
   - 子网掩码的网络地址部分和子网地址部分全为1，它的主机部分全为0
- 一个缺省C类IP地址的掩码为：
   - 255.255.255.0

例题：

- 一个C类主机地址为202.120.3.99，所属 子网号为 011，其掩码应为：255.255.255.224
- 掩码也可用更简洁的方式表示：202.120.3.99/27，其中27表示掩码中1的个数

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391434598-33d8cbbf-00de-461a-8f82-e36e12e4c2ec.png#averageHue=%23b6dee7&clientId=ued772dcd-aa97-4&from=paste&id=u4070f0d5&originHeight=348&originWidth=849&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u3b05491a-3c4e-444f-a38d-64fb4ec50c0&title=)
#### 子网划分
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391434854-fe91e0ad-c7c6-465d-a290-7bce19ed360b.png#averageHue=%23addae8&clientId=ued772dcd-aa97-4&from=paste&id=ue2db1a8b&originHeight=716&originWidth=1000&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u5c878459-08c4-4778-a75b-b2ca8192a8e&title=)

- 三个子网一共只有10台主机，因此一个C类地址就足够了
- 子网和主机所需位数的分配：可以根据子网数或者每个子网中的主机数来决定
- 如按子网数来决定：3个子网需要2位编码：00，01，10，11，但一般00和11保留，因此3个子网需要3位编码，则子网掩码为：202.120.1.0/27

例：某单位有多个部门，每个部门的机器数为20个左右，现申请有一个C类地址 202.10.23.0，问： 就目前而言，如何划分子网较为合理，请确定子网掩码，每个子网中主机数最多为多少台?

- 用3位表示子网号，5位表示主机号是合理的，所以：
- 掩码为：255.255.255.224；最多的子网个数：8(6)个
- 每个子网中主机数最多可接：32 – 2 = 30（台）
- 某个主机IP地址及其掩码也可写成：202.10.23.47/27
### ⽹络地址转换NAT
一般来说每台主机都有一个固定的IP地址用于表示自己在Internet中的身份，但一个单位只能分配到少量的公开IP地址，同时也为了安全而不向Internet公开单位内部的地址，所以企业内部的主机通常都使用私有地址，当内部主机要访问Internet时，必须进行“网络地址转换”，即把私有IP地址转换成公开IP地址
#### NAT的工作过程

- 假设内部网络使用内部网络地址192.168.44.0，并已申请到公开IP地址为202.120.8.65-202.120.8.79，内部主机PC3的IP地址为192.168.44.89
- PC3发出一个请求通过ISP访问Internet，目的IP地址为202.120.1.154
- Router（Firewall）将对请求IP包和返回的应答IP包作NAT

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391434979-b06571a1-de7a-4426-a43b-3f957f7d5ff1.png#averageHue=%23b2dbe5&clientId=ued772dcd-aa97-4&from=paste&id=u77e655a9&originHeight=427&originWidth=997&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u70b0518c-aeb5-4483-9ce7-3487954928a&title=)
#### 请求IP包和应答IP包的NAT

- 当请求IP包到达路由器时，将IP包中的源IP地址和源端口号信息填入NAT表（映射表），同时将对应的NAT表表项序号取代IP包中的源端口号字段，并将选定的合法地址（即公开IP地址）取代IP包中的源IP地址字段，重新计算校验和并发送
- 当应答IP包从ISP发回来时，路由器将抽取该应答IP包中目的端口号字段，查NAT表将表中对应的内容放回目的IP地址字段和目的端口号字段，发回源节点
#### NAT存在的问题

- NAT违反了IP的体系结构
   - IP规定一个IP地址对应一个网络接口，而在NAT中，某个地址可能会对应成千上万个地址
- NAT将Internet的无连接服务变成了有连接服务
   - 因为NAT必须包含所有经过它的连接信息
- NAT违反了网络分层原则
   - 在第三层用了第四层协议格式中的字段
- 如果IP包的载荷不是TCP或UDP，则NAT无法工作
   - 因为在其他协议的信息中不包含源端口号
- 在有些应用中NAT可能会出错
   - 在有些应用中，发送方会将源IP地址嵌在它的消息中，接收方必须从信息中取用源IP地址，但NAT不作此类处理，因而将导致错误
### ICMP

- IP协议提供的是尽力而为的通信服务 
- 数据报的丢失、重复、延迟、乱序在所难免 
- ICMP提供了一种把通信服务中的差错向源站点报告的机制
#### ICMP报文格式 
![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391434980-6a6839fd-ed8f-434f-a371-1e160ef649f6.png#averageHue=%23b4dde6&clientId=ued772dcd-aa97-4&from=paste&id=u6ce28ea5&originHeight=358&originWidth=775&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=u1fcf478b-1392-4849-b120-694228f8ffa&title=)
#### ICMP报文主要类型

- 差错报文
- 控制报文
- 请求/应答报文
#### ICMP应用举例

- 测试报文的可达性 
   - ping
      - 使用ping命令（即调用ping过程）时，将向目的站点发送一个ICMP回应请求报文（包括一些任选的数据），如目的站点接收到该报文，必须向源站点发回一个ICMP回应应答报文，源站点收到应答报文（且其中的任选数据与所发送的相同），则认为目的站点是可达的，否则为不可达 
- 路由跟踪 
   - tracert（Unix下为traceroute）
      - tracert过程是通过ICMP数据报超时报文来得到一张途经路由器端口列表的 
      - 源主机向目的主机发一个IP报文，并置hop为1，到达第一个路由器时，hop减1，为0，则该路由器回发一个ICMP数据报超时报文，源主机取出路由器的IP地址即为途经的第一个路由端口地址 
      - 接着源主机再向目的主机发第二个IP报文，并置hop为2，然后再发第三个、第四个IP数据报，… …直至到达目的主机
      - 但互联网的运行环境状态是动态的，每次路径的选择有可能不一致，所以，只有在相对较稳定（相对变化较缓慢）的互联网中，tracert才是有意义的
- 得到路径中最小的MTU 
   - 源主机发送一系列的探测IP数据报，并置DF = 1，即不允许分段，如途经某个网络的MTU较小，则路由器将丢弃该数据报并发回一个ICMP数据报参数错，要求分段，源主机则逐步减小数据报长度，并仍置DF = 1，直至某个探测报文成功到达目的主机，即得到路径中的最小MTU 
### ARP 	地址解析	了解
#### 地址解析的作用 

- 协议地址 
   - 软件提供的抽象地址，如IP地址，它使整个互联网看成一个网络，但真正的物理网络并不能通过IP地址来定位主机
- 物理地址
   - 硬件地址，如MAC地址
- 地址解析 
   - 协议地址和物理地址之间的转换，如IP地址和MAC地址之间的转换

地址解析必须在某一物理网络中进行，一台主机在向同一物理网络上的另一台计算机发送数据时，应先做地址解析，然后按物理地址直接发送数据帧 
#### 工作原理（以IP网络为例） 

- 一个ARP请求消息是一个数据帧，其中包含发送站点的MAC地址和IP地址，以及目的站点的IP地址，并把此数据帧在本物理网络内广播 
- 一个ARP应答消息是一个数据帧，其中包含应答站点的MAC地址和IP地址，以及原发送站点的IP地址，并把此数据帧发送给原发送站点 

![](https://cdn.nlark.com/yuque/0/2023/png/35951671/1684391435192-9cdce5f0-c797-4f18-8a34-79c2284485b6.png#averageHue=%23b2dce7&clientId=ued772dcd-aa97-4&from=paste&id=ue95913ae&originHeight=670&originWidth=899&originalType=url&ratio=1.1041666269302368&rotation=0&showTitle=false&status=done&style=none&taskId=uc2823fda-3c02-4779-bd53-631c92ec836&title=)
### RIP 协议	OSPF 协议
#### RIP 协议

- RIP采用D-V路由算法，是Internet的一个主要路由协议
- 传输层采用**UDP协议**
- 用跳数作为距离
- RIP协议有两个报文：请求包和响应包
#### OSPF协议

- OSPF协议采用链路状态法，直接IP协议传送
- OSPF协议中的距离可以是真正的距离，也可以是费用、时延、带宽等
- 网络拓扑信息存放在网络拓扑数据库 
- 只有当链路状态变化时，才发送信息
- 分层路由
   - OSPF采用分层结构。使之能适合较大规模的网络
   - 将整个网络分成若干个小区域
   - 每个区域有一个区域边界路由器与其他区域相连
   - 所有的区域边界路由器连接起来的区域称为区域0

	OSPF的路由器类型

- 内部路由器：
   - 该路由器连接的网络在同一区域中，这些路由器有相同的网络拓扑信息 
- 区域边界路由器ABR：
   - 指连接两个或多个区域的路由器 
- AS边界路由器ASBR ：
   - 连接多个AS的路由器 
### IPv6 主要改进	冒分⼗六进制

- 更大的地址空间：16字节，128位 
- 首部的 简化：只有7个固定域，撤消了有关分段的域和校验和域，以便更快地处理分组，提高路由器的吞吐量，缩短延时
- 更好地支持选项：选项是有次序的，以便路由器可简单地跳过与它无关的选项，加快分组的处理速度
- 增强了安全性：认证和隐私是关键特征
- 更加关注服务质量：以支持Internet上日益增长的多媒体应用


 
